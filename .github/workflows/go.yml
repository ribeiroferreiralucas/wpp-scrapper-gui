name: Go

on:
  push:
    tags:
     - '*'
 
jobs:

  build_linux:
    name: Build Linux
    runs-on: ubuntu-latest
    env: 
      FILENAME: wppscrapper-gui-linux-
    steps:
    - uses: actions/checkout@v2
    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.15
    - name: Get Fyne cmd
      run: go get fyne.io/fyne/v2/cmd/fyne
    
    - name: Get fyne-cross
      run: go get github.com/fyne-io/fyne-cross
    
    - name: Build
      run: |
        fyne-cross linux -arch=amd64,386
        mv fyne-cross/dist/linux-386/wpp-scrapper-gui.tar.gz ${{ env.FILENAME }}386.tar.gz
        mv fyne-cross/dist/linux-amd64/wpp-scrapper-gui.tar.gz ${{ env.FILENAME }}amd64.tar.gz

    - name: Archive production artifacts
      uses: actions/upload-artifact@v2
      with:
        path: |
          ${{ env.FILENAME }}amd64.tar.gz
          ${{ env.FILENAME }}386.tar.gz
          
  build_windows:
      name: Build Windows
      runs-on: ubuntu-latest
      env: 
        FILENAME: wppscrapper-gui-windows-
      steps:
      - uses: actions/checkout@v2
      - name: Set up Go
        uses: actions/setup-go@v2
        with:
          go-version: 1.15
      - name: Get Fyne cmd
        run: go get fyne.io/fyne/v2/cmd/fyne

      - name: Get fyne-cross
        run: go get github.com/fyne-io/fyne-cross

      - name: Build
        run: |
          fyne-cross windows -arch=amd64,386
          mv fyne-cross/dist/windows-386/wpp-scrapper-gui.exe ${{ env.FILENAME }}x86.exe
          mv fyne-cross/dist/windows-amd64/wpp-scrapper-gui.exe ${{ env.FILENAME }}x64.exe

      - name: Archive production artifacts
        uses: actions/upload-artifact@v2
        with:
          path: |
            ${{ env.FILENAME }}x86.exe
            ${{ env.FILENAME }}x64.exe
